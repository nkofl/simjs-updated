
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta content="General Purpose Discrete Event Simulation Library in JavaScript" name="description" />
<meta content="discrete event simulation, simulation, javascript, web simulation, javascript simulator" name="keywords" />

    <title>SIM.JS | Discrete Event Simulation in JavaScript</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Buffet Restaurant" href="buffet-restaurant.html" />
    <link rel="prev" title="SIM.JS Tutorial" href="../tutorial.html" />

   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-24240723-1']);
_gaq.push(['_trackPageview']);

(function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="traffic-lights-at-intersection">
<span id="example-traffic-lights"></span><h1>Traffic Lights at Intersection<a class="headerlink" href="#traffic-lights-at-intersection" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-system">
<h2>The System<a class="headerlink" href="#the-system" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial example we will model traffic lights at an intersection. We will simplify the problem as follows:</p>
<ul class="simple">
<li>There is only one intersection of “North-South” street and “East-West” street.</li>
<li>Vehicles do not make turns at the intersection. They continue in their original direction, if the traffic light is green.</li>
<li>The traffic light itself has two states: Red and Green.</li>
<li>The vehicles arrive at the intersection as poisson process. That is, the interval between two successive vehicles is exponentially distributed. The four directions are considered as Identical Independent Distributions (IID).</li>
</ul>
<p><strong>Simulation Objectives</strong>. The parameters to our simplified system are: (a) the time that the light remains green, and (b) the rate at which vehicles arrive. Given these two, we would like to know:</p>
<ul class="simple">
<li>What is average duration that vehicles have to wait at the intersection?</li>
<li>What is the average number of vehicles that are waiting at the intersection?</li>
</ul>
</div>
<div class="section" id="modeling-with-sim-js">
<h2>Modeling with SIM.JS<a class="headerlink" href="#modeling-with-sim-js" title="Permalink to this headline">¶</a></h2>
<p>We will model the traffic lights as <a class="reference internal" href="../events.html#events-events"><span class="std std-ref">Events</span></a>. We will have two events, one for the North-South street and another for the East-West Street.</p>
<p>We will model the traffic as <strong>one</strong> <a class="reference internal" href="../entities.html#entity-entity"><span class="std std-ref">Sim.Entity</span></a>, that will generate <em>requests</em> to cross the intersection. This entity will generate four exponential IID requests (for the vehicles in four directions).</p>
<p>We are interested in measuring the time spent by the vehicles at the intersection. We can consider the number of vehicles waiting at intersection as <a class="reference internal" href="../statistics.html#statistics-population"><span class="std std-ref">Population Statistics</span></a> and will use the Population class for recording statistics.</p>
<p>We begin by creating an instance of simulator:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">sim</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sim</span><span class="p">.</span><span class="nx">Sim</span><span class="p">();</span>
</pre></div>
</div>
<p>Next we create two events to model the traffic lights and give them descriptive names:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">trafficLights</span> <span class="o">=</span> <span class="p">[</span><span class="k">new</span> <span class="nx">Sim</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;North-South Light&quot;</span><span class="p">),</span>
                     <span class="k">new</span> <span class="nx">Sim</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;East-West Light&quot;</span><span class="p">)];</span>
</pre></div>
</div>
<p>To monitor the statistics, we create an object of Population class:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">stats</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sim</span><span class="p">.</span><span class="nx">Population</span><span class="p">(</span><span class="s2">&quot;Waiting at Intersection&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Of course, we create a random number generator:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">random</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Random</span><span class="p">(</span><span class="nx">SEED</span><span class="p">);</span>
</pre></div>
</div>
<p>We will create two entities: one to control the traffic lights, another to generate the vehicle traffic. Lets look at traffic light controller first.</p>
<p>The traffic light controller periodically turns off lights in one direction and turns on the other. This process is repeated indefinitely at interval of GREEN_TIME seconds.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">LightController</span> <span class="kr">extends</span> <span class="nx">Sim</span><span class="p">.</span><span class="nx">Entity</span> <span class="p">{</span>
    <span class="nx">currentLight</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1">// the light that is turned on currently</span>
    <span class="nx">start</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Logging</span>
        <span class="nx">sim</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">trafficLights</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentLight</span><span class="p">].</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; OFF&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nx">trafficLights</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentLight</span><span class="p">].</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; ON&quot;</span><span class="p">);</span>
        <span class="nx">sim</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;------------------------------------------&quot;</span><span class="p">);</span>

        <span class="c1">// turn off the current light</span>
        <span class="nx">trafficLights</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentLight</span><span class="p">].</span><span class="nx">clear</span><span class="p">();</span>

        <span class="c1">// turn on the other light.</span>
        <span class="c1">// Note the true parameter: the event must &quot;sustain&quot;</span>
        <span class="nx">trafficLights</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentLight</span><span class="p">].</span><span class="nx">fire</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

        <span class="c1">// update the currentLight variable</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">currentLight</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentLight</span><span class="p">;</span>

        <span class="c1">// Repeat every GREEN_TIME interval</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setTimer</span><span class="p">(</span><span class="nx">GREEN_TIME</span><span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Quite a few things are happening here. Lets dissect the code now:</p>
<ul class="simple">
<li>First we create a JavaScript class (which is mostly interchangeable with prototype) that inherits all the behavior of Sim.Entity, and implements the <code class="xref py py-func docutils literal notranslate"><span class="pre">start()</span></code> function. Later on we will use the <code class="xref py py-func docutils literal notranslate"><span class="pre">Sim.addEntity()</span></code> function to create <code class="docutils literal notranslate"><span class="pre">Entity</span> <span class="pre">objects</span></code>. Of course, more than one objects can be created from the same <code class="docutils literal notranslate"><span class="pre">Entity</span> <span class="pre">Prototype</span></code> object (although in this example we create only one entity object).</li>
<li>When we call the <code class="xref py py-func docutils literal notranslate"><span class="pre">Sim.addEntity()</span></code> the simulator kernel adds other functions and attributes to the Entity prototype object. We call this new object as <code class="docutils literal notranslate"><span class="pre">Extended</span> <span class="pre">Entity</span> <span class="pre">Prototype</span></code> object. For example, <code class="xref py py-func docutils literal notranslate"><span class="pre">this.setTimer()</span></code> was added by the simulator. Refer to <a class="reference internal" href="../entities.html#id1"><span class="std std-ref">Extended Entity Prototype API</span></a> for a complete list of extended functions and attributes. The simulator now creates a new object with the extended entity prototype object as the <em>prototype</em>.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">Entity</span> <span class="pre">prototype</span></code> object <strong>must</strong> define a <em>start</em> function. This function is called by the simulator when the simulation starts.</li>
<li>Notice that the events are fired with <em>true</em> argument, which indicates that the events must remain in ‘fired state’ until explicitly cleared. The default behavior is that the events fire for an instant only and go back to passive state immediately.</li>
<li>The <code class="xref py py-func docutils literal notranslate"><span class="pre">setTimer()</span></code> function sets a timers for GREEN_TIME duration, and at expiry will call <code class="xref py py-func docutils literal notranslate"><span class="pre">this.start()</span></code> function. The setTimer function returns a <a class="reference internal" href="../request.html#request-main"><span class="std std-ref">Request</span></a> object that can be used to modify the request. In this case we attach a callback function that must be called after the timer expires (via the <code class="xref py py-func docutils literal notranslate"><span class="pre">done()</span></code> function).</li>
<li>We have used <code class="xref py py-func docutils literal notranslate"><span class="pre">sim.log()</span></code> function to log the actions to help us debugging.</li>
</ul>
<p>Moving on to the entity to generate traffic. Lets look at the code first:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Traffic</span> <span class="kr">extends</span> <span class="nx">Sim</span><span class="p">.</span><span class="nx">Entity</span> <span class="p">{</span>
    <span class="nx">start</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">generateTraffic</span><span class="p">(</span><span class="s2">&quot;North&quot;</span><span class="p">,</span> <span class="nx">trafficLights</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// traffic for North -&gt; South</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">generateTraffic</span><span class="p">(</span><span class="s2">&quot;South&quot;</span><span class="p">,</span> <span class="nx">trafficLights</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// traffic for South -&gt; North</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">generateTraffic</span><span class="p">(</span><span class="s2">&quot;East&quot;</span><span class="p">,</span> <span class="nx">trafficLights</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">// traffic for East -&gt; West</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">generateTraffic</span><span class="p">(</span><span class="s2">&quot;West&quot;</span><span class="p">,</span> <span class="nx">trafficLights</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">// traffic for West -&gt; East</span>
    <span class="p">},</span>
    <span class="nx">generateTraffic</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">light</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Logging</span>
        <span class="nx">sim</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Arrive for &quot;</span> <span class="o">+</span> <span class="nx">direction</span><span class="p">);</span>

        <span class="c1">// STATS: record that vehicle as entered the intersection</span>
        <span class="nx">stats</span><span class="p">.</span><span class="nx">enter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">time</span><span class="p">());</span>

        <span class="c1">// wait on the light.</span>
        <span class="c1">// The done() function will be called when the event fires</span>
        <span class="c1">// (i.e. the light turns green).</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">waitEvent</span><span class="p">(</span><span class="nx">light</span><span class="p">).</span><span class="nx">done</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">arrivedAt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">callbackData</span><span class="p">;</span>

            <span class="c1">// Logging</span>
            <span class="nx">sim</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Leave for &quot;</span> <span class="o">+</span> <span class="nx">direction</span> <span class="o">+</span> <span class="s2">&quot; (arrived at &quot;</span> <span class="o">+</span> <span class="nx">arrivedAt</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">);</span>

            <span class="c1">// STATS: record that vehicle has left the intersection</span>
            <span class="nx">stats</span><span class="p">.</span><span class="nx">leave</span><span class="p">(</span><span class="nx">arrivedAt</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">time</span><span class="p">());</span>
        <span class="p">}).</span><span class="nx">setData</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">time</span><span class="p">());</span>

        <span class="c1">// Repeat for the next car. Call this function again.</span>
        <span class="kd">var</span> <span class="nx">nextArrivalAt</span> <span class="o">=</span> <span class="nx">random</span><span class="p">.</span><span class="nx">exponential</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="nx">MEAN_ARRIVAL</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setTimer</span><span class="p">(</span><span class="nx">nextArrivalAt</span><span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">generateTraffic</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">light</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Lets follow this code:</p>
<ul class="simple">
<li>As before, we subclass <code class="docutils literal notranslate"><span class="pre">Sim.Entity</span></code> and implement a <code class="xref py py-func docutils literal notranslate"><span class="pre">start()</span></code> function.</li>
<li>We also notice that <code class="xref py py-func docutils literal notranslate"><span class="pre">this.time()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">this.setTimer()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">this.waitEvent()</span></code> are added by the simulator to this entity prototype object.</li>
<li>The <code class="xref py py-func docutils literal notranslate"><span class="pre">generateTraffic()</span></code> function generates traffic for one street for one direction. We call this function four times in our start function.</li>
<li><dl class="first docutils">
<dt><code class="xref py py-func docutils literal notranslate"><span class="pre">this.waitEvent()</span></code> illustrates the most typical design pattern for requesting resources. The entity first make a request (in this case, wait for the event – the traffic light – to fire) which returns a <a class="reference internal" href="../request.html#request-main"><span class="std std-ref">Request</span></a> object. The entities then call the <code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code> class functions to fine tune the request. Each of these function return the request object back, so the functions can be chained together. In this case we call two functions on request object:</dt>
<dd><ul class="first last">
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">Request.done()</span></code>. This assigns a callback function which will be called when the request is satisfied. In our case, we use the callback to update the statistics.</li>
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">Request.setData()</span></code>. This stores some user data that can be retrieved later from :attr:this.callbackData` attribute within the callback function. In this case, we store the current time (which is the arrival time).</li>
</ul>
</dd>
</dl>
</li>
<li>We have seen the <code class="xref py py-func docutils literal notranslate"><span class="pre">this.setTimer()</span></code> earlier too, however, this time we use the complete three-argument form: <code class="xref py py-attr docutils literal notranslate"><span class="pre">this.setTimer(callbackFn,</span> <span class="pre">context,</span> <span class="pre">data)</span></code>. <em>callbackFn</em> is the callback function (this.generateTraffic in our example), <em>context</em> is object in whose context this function will be called, and <em>data</em> will become argument to the callback function.</li>
<li>Note that there are two ways to pass data to the callback functions: via the <code class="xref py py-func docutils literal notranslate"><span class="pre">Request.setData()</span></code> as <code class="xref py py-attr docutils literal notranslate"><span class="pre">this.callbackData</span></code> or passing data along with callback function which shows up arguments to the callback function. The difference between the two is that the former data will appear for <em>all</em> callback functions, whereas the latter will be specific to one callback function only. The following example should explain this:</li>
</ul>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">waitEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
<span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="s1">&#39;Data to all callback functions&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="nx">fn1</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="s1">&#39;data to fn1 only&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="nx">fn2</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="s1">&#39;data to fn2 only&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">waitUntil</span><span class="p">(</span><span class="nx">fn3</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="s1">&#39;data to fn3 only&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">unlessEvent</span><span class="p">(</span><span class="nx">fn4</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="s1">&#39;data to fn4 only&#39;</span><span class="p">);</span>

<span class="nx">fn1</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">(</span><span class="nx">arg</span> <span class="o">==</span> <span class="s1">&#39;data to fn1 only&#39;</span><span class="p">);</span>
    <span class="nx">assert</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">callbackData</span> <span class="o">==</span> <span class="s1">&#39;Data to all callback functions&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">fn2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">(</span><span class="nx">arg</span> <span class="o">==</span> <span class="s1">&#39;data to fn2 only&#39;</span><span class="p">);</span>
    <span class="nx">assert</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">callbackData</span> <span class="o">==</span> <span class="s1">&#39;Data to all callback functions&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Having created the entity prototype objects we create the actual entity objects</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">sim</span><span class="p">.</span><span class="nx">addEntity</span><span class="p">(</span><span class="nx">LightController</span><span class="p">);</span>
<span class="nx">sim</span><span class="p">.</span><span class="nx">addEntity</span><span class="p">(</span><span class="nx">Traffic</span><span class="p">);</span>
</pre></div>
</div>
<p>And finally, we start simulation:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// simulate for SIMTIME time</span>
<span class="nx">sim</span><span class="p">.</span><span class="nx">simulate</span><span class="p">(</span><span class="nx">SIMTIME</span><span class="p">);</span>
</pre></div>
</div>
<p><a class="reference external" href="traffic_lights.js">View the complete source code</a>.</p>
</div>
<div class="section" id="running-simulation">
<h2>Running Simulation<a class="headerlink" href="#running-simulation" title="Permalink to this headline">¶</a></h2>
<p>This javascript code can be executed where ever javascript can run. This includes:</p>
<ul class="simple">
<li>As a script in HTML page on a web browser.</li>
<li>Via Web browser JavaScript debuggers such as Mozilla Firebug, Safari’s Developer tools etc.</li>
<li>With <a class="reference external" href="www.mozilla.org/rhino">Rhino</a>.</li>
<li>With <code class="docutils literal notranslate"><span class="pre">jrunscript</span></code>.</li>
<li>and so on…</li>
</ul>
<p>We will run our model as a web page on a web browser. For this we have created the following web page:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span>&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Tutorial: Simulation of Traffic Lights at Intersection&lt;/title&gt;

    &lt;script type=&quot;text/javascript&quot; src=&quot;sim-0.1.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;traffic-light.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
</div>
<div class="section" id="tracing-simulation-runs">
<h2>Tracing Simulation Runs<a class="headerlink" href="#tracing-simulation-runs" title="Permalink to this headline">¶</a></h2>
<p>Having completed the model let us first see that the model is working correctly. We can use the <span class="xref std std-ref">debug-log</span> feature of the simulator to log events and actions.</p>
<p>We have already added the logging support in our code. To enable logging, we use the <code class="xref py py-func docutils literal notranslate"><span class="pre">Sim.setLogger()</span></code> function:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// add these lines before starting simulation</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s2">&quot;&lt;pre&gt;&quot;</span><span class="p">);</span>
<span class="nx">sim</span><span class="p">.</span><span class="nx">setLogger</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>Remember to add these lines before the <code class="xref py py-func docutils literal notranslate"><span class="pre">sim.simulate()</span></code> function. The <em>setLogger</em> function takes as input a ‘writer’ function that will be invoked to write trace logs. In our case, we output the trace logs to the web document. We have also added the “&lt;pre&gt;” tag so that the output is displayed as well formatted text.</p>
<p>Lets first disable the logging statement in the Traffic function so that we see the output from the LightController entity only. To help in visualization, we have selected rather extreme values with GREEN_TIME = 5 min, MEAN_ARRIVAL = 1 min, SIMTIME = 30 min and SEED = 1234.</p>
<p>We see the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.000000</span>   <span class="n">North</span><span class="o">-</span><span class="n">South</span> <span class="n">Light</span> <span class="n">OFF</span><span class="p">,</span> <span class="n">East</span><span class="o">-</span><span class="n">West</span> <span class="n">Light</span> <span class="n">ON</span>
<span class="mf">0.000000</span>   <span class="o">------------------------------------------</span>
<span class="mf">5.000000</span>   <span class="n">East</span><span class="o">-</span><span class="n">West</span> <span class="n">Light</span> <span class="n">OFF</span><span class="p">,</span> <span class="n">North</span><span class="o">-</span><span class="n">South</span> <span class="n">Light</span> <span class="n">ON</span>
<span class="mf">5.000000</span>   <span class="o">------------------------------------------</span>
<span class="mf">10.000000</span>   <span class="n">North</span><span class="o">-</span><span class="n">South</span> <span class="n">Light</span> <span class="n">OFF</span><span class="p">,</span> <span class="n">East</span><span class="o">-</span><span class="n">West</span> <span class="n">Light</span> <span class="n">ON</span>
<span class="mf">10.000000</span>   <span class="o">------------------------------------------</span>
<span class="mf">15.000000</span>   <span class="n">East</span><span class="o">-</span><span class="n">West</span> <span class="n">Light</span> <span class="n">OFF</span><span class="p">,</span> <span class="n">North</span><span class="o">-</span><span class="n">South</span> <span class="n">Light</span> <span class="n">ON</span>
<span class="mf">15.000000</span>   <span class="o">------------------------------------------</span>
<span class="mf">20.000000</span>   <span class="n">North</span><span class="o">-</span><span class="n">South</span> <span class="n">Light</span> <span class="n">OFF</span><span class="p">,</span> <span class="n">East</span><span class="o">-</span><span class="n">West</span> <span class="n">Light</span> <span class="n">ON</span>
<span class="mf">20.000000</span>   <span class="o">------------------------------------------</span>
<span class="mf">25.000000</span>   <span class="n">East</span><span class="o">-</span><span class="n">West</span> <span class="n">Light</span> <span class="n">OFF</span><span class="p">,</span> <span class="n">North</span><span class="o">-</span><span class="n">South</span> <span class="n">Light</span> <span class="n">ON</span>
<span class="mf">25.000000</span>   <span class="o">------------------------------------------</span>
<span class="mf">30.000000</span>   <span class="n">North</span><span class="o">-</span><span class="n">South</span> <span class="n">Light</span> <span class="n">OFF</span><span class="p">,</span> <span class="n">East</span><span class="o">-</span><span class="n">West</span> <span class="n">Light</span> <span class="n">ON</span>
<span class="mf">30.000000</span>   <span class="o">------------------------------------------</span>
</pre></div>
</div>
<p>This make sense, the lights switch every 5 minutes.</p>
<p>Next we enable the logging statement in the Traffic entity. We show only some selected lines from the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.000000</span>   <span class="n">North</span><span class="o">-</span><span class="n">South</span> <span class="n">Light</span> <span class="n">OFF</span><span class="p">,</span> <span class="n">East</span><span class="o">-</span><span class="n">West</span> <span class="n">Light</span> <span class="n">ON</span>
<span class="mf">0.000000</span>   <span class="o">------------------------------------------</span>
<span class="mf">0.000000</span>   <span class="n">Arrive</span> <span class="k">for</span> <span class="n">North</span>
<span class="mf">0.000000</span>   <span class="n">Arrive</span> <span class="k">for</span> <span class="n">South</span>
<span class="mf">0.000000</span>   <span class="n">Arrive</span> <span class="k">for</span> <span class="n">East</span>
<span class="mf">0.000000</span>   <span class="n">Arrive</span> <span class="k">for</span> <span class="n">West</span>
<span class="mf">0.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">East</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">0.000000</span><span class="p">)</span>
<span class="mf">0.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">West</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">0.000000</span><span class="p">)</span>
<span class="mf">0.034122</span>   <span class="n">Arrive</span> <span class="k">for</span> <span class="n">North</span>
<span class="mf">0.250816</span>   <span class="n">Arrive</span> <span class="k">for</span> <span class="n">South</span>
<span class="mf">0.819317</span>   <span class="n">Arrive</span> <span class="k">for</span> <span class="n">East</span>
<span class="mf">0.819317</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">East</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">0.819317</span><span class="p">)</span>
<span class="mf">0.912556</span>   <span class="n">Arrive</span> <span class="k">for</span> <span class="n">East</span>
<span class="mf">0.912556</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">East</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">0.912556</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">lines</span> <span class="n">omitted</span><span class="o">&gt;</span>
<span class="mf">5.000000</span>   <span class="n">East</span><span class="o">-</span><span class="n">West</span> <span class="n">Light</span> <span class="n">OFF</span><span class="p">,</span> <span class="n">North</span><span class="o">-</span><span class="n">South</span> <span class="n">Light</span> <span class="n">ON</span>
<span class="mf">5.000000</span>   <span class="o">------------------------------------------</span>
<span class="mf">5.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">North</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">0.000000</span><span class="p">)</span>
<span class="mf">5.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">South</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">0.000000</span><span class="p">)</span>
<span class="mf">5.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">North</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">0.034122</span><span class="p">)</span>
<span class="mf">5.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">South</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">0.250816</span><span class="p">)</span>
<span class="mf">5.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">South</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">2.651636</span><span class="p">)</span>
<span class="mf">5.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">North</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">4.928112</span><span class="p">)</span>
<span class="mf">5.129310</span>   <span class="n">Arrive</span> <span class="k">for</span> <span class="n">South</span>
<span class="mf">5.129310</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">South</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">5.129310</span><span class="p">)</span>
<span class="mf">5.144233</span>   <span class="n">Arrive</span> <span class="k">for</span> <span class="n">East</span>
<span class="mf">5.194057</span>   <span class="n">Arrive</span> <span class="k">for</span> <span class="n">North</span>
<span class="mf">5.194057</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">North</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">5.194057</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">lines</span> <span class="n">omitted</span><span class="o">&gt;</span>
<span class="mf">10.000000</span>   <span class="n">North</span><span class="o">-</span><span class="n">South</span> <span class="n">Light</span> <span class="n">OFF</span><span class="p">,</span> <span class="n">East</span><span class="o">-</span><span class="n">West</span> <span class="n">Light</span> <span class="n">ON</span>
<span class="mf">10.000000</span>   <span class="o">------------------------------------------</span>
<span class="mf">10.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">East</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">5.144233</span><span class="p">)</span>
<span class="mf">10.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">West</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">5.230096</span><span class="p">)</span>
<span class="mf">10.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">East</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">6.584731</span><span class="p">)</span>
<span class="mf">10.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">East</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">7.645791</span><span class="p">)</span>
<span class="mf">10.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">East</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">8.079168</span><span class="p">)</span>
<span class="mf">10.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">East</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">8.551925</span><span class="p">)</span>
<span class="mf">10.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">West</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">8.709882</span><span class="p">)</span>
<span class="mf">10.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">West</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">9.194689</span><span class="p">)</span>
<span class="mf">10.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">East</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">9.277087</span><span class="p">)</span>
<span class="mf">10.000000</span>   <span class="n">Leave</span> <span class="k">for</span> <span class="n">West</span> <span class="p">(</span><span class="n">arrived</span> <span class="n">at</span> <span class="mf">9.963535</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">lines</span> <span class="n">omitted</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Note the first four arrival lines. Only the East- and West-bound vehicles leave the intersection. Notice also at 5.0 minutes, all the North and South bound vehicles leave intersection as soon as the light turns green. You can follow the logs to verify that our traffic light model is indeed working correctly.</p>
</div>
<div class="section" id="statistics">
<h2>Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h2>
<p>We are ultimately interested in average statistics of our model. For this problem we would like to know:</p>
<ul class="simple">
<li>What is average duration that vehicles have to wait at the intersection?</li>
<li>What is the average number of vehicles that are waiting at the intersection?</li>
</ul>
<p>We have used the <a class="reference internal" href="../statistics.html#statistics-population"><span class="std std-ref">Population Statistics</span></a> statistics to monitor the vehicle traffic at the intersection. <code class="xref py py-attr docutils literal notranslate"><span class="pre">Population.durationSeries</span></code> (which is a <a class="reference internal" href="../statistics.html#statistics-time-series"><span class="std std-ref">Time Series Statistics</span></a>) records the duration for which vehicles wait at the intersection, and <code class="xref py py-attr docutils literal notranslate"><span class="pre">Population.sizeSeries</span></code> (which is a <a class="reference internal" href="../statistics.html#statistics-data-series"><span class="std std-ref">Data Series Statistics</span></a>) records the number of vehicles standing at the intersection.</p>
<p>To output these two statistics, add the following lines after the <code class="xref py py-func docutils literal notranslate"><span class="pre">sim.simulate()</span></code> call.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s2">&quot;Number of vehicles at intersection (average) = &quot;</span>
        <span class="o">+</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">sizeSeries</span><span class="p">.</span><span class="nx">average</span><span class="p">().</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="o">+</span> <span class="s2">&quot; (+/- &quot;</span> <span class="o">+</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">sizeSeries</span><span class="p">.</span><span class="nx">deviation</span><span class="p">().</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="o">+</span> <span class="s2">&quot;)\n&quot;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s2">&quot;Time spent at the intersection (average) = &quot;</span>
        <span class="o">+</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">durationSeries</span><span class="p">.</span><span class="nx">average</span><span class="p">().</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="o">+</span> <span class="s2">&quot; (+/- &quot;</span> <span class="o">+</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">durationSeries</span><span class="p">.</span><span class="nx">deviation</span><span class="p">().</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="o">+</span> <span class="s2">&quot;)\n&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The output for our rather contrived input values is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">of</span> <span class="n">vehicles</span> <span class="n">at</span> <span class="n">intersection</span> <span class="p">(</span><span class="n">average</span><span class="p">)</span> <span class="o">=</span> <span class="mf">4.264</span> <span class="p">(</span><span class="o">+/-</span> <span class="mf">2.069</span><span class="p">)</span>
<span class="n">Time</span> <span class="n">spent</span> <span class="n">at</span> <span class="n">the</span> <span class="n">intersection</span> <span class="p">(</span><span class="n">average</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.361</span> <span class="p">(</span><span class="o">+/-</span> <span class="mf">1.830</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="traffic-lights-in-action">
<h2>Traffic Lights in Action<a class="headerlink" href="#traffic-lights-in-action" title="Permalink to this headline">¶</a></h2>
<p>You can <a class="reference external" href="traffic_lights.html">play with this simulation model</a>. Try out different values of input parameters and compare the output statistics of model.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Traffic Lights at Intersection</a><ul>
<li><a class="reference internal" href="#the-system">The System</a></li>
<li><a class="reference internal" href="#modeling-with-sim-js">Modeling with SIM.JS</a></li>
<li><a class="reference internal" href="#running-simulation">Running Simulation</a></li>
<li><a class="reference internal" href="#tracing-simulation-runs">Tracing Simulation Runs</a></li>
<li><a class="reference internal" href="#statistics">Statistics</a></li>
<li><a class="reference internal" href="#traffic-lights-in-action">Traffic Lights in Action</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../tutorial.html">SIM.JS Tutorial</a><ul>
      <li>Previous: <a href="../tutorial.html" title="previous chapter">SIM.JS Tutorial</a></li>
      <li>Next: <a href="buffet-restaurant.html" title="next chapter">Buffet Restaurant</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
      &copy;2011, Maneesh Varshney.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    


  </body>
</html>